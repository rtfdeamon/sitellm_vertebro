# –ü–ª–∞–Ω —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

**–î–∞—Ç–∞**: 2025-11-16  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏ —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (14 –∑–∞–¥–∞—á)

1. ‚úÖ Knowledge summary —É–ª—É—á—à–µ–Ω (batch, cache, metrics)
2. ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Ä–æ—É—Ç–µ—Ä—ã: backup, stats, admin, projects (–±–∞–∑–æ–≤—ã–π CRUD)
3. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—á–µ—Å—Ç–≤–æ —É–ª—É—á—à–µ–Ω—ã
4. ‚úÖ CI/CD —É–ª—É—á—à–µ–Ω

**–ü—Ä–æ–≥—Ä–µ—Å—Å**: ~943 LOC –≤—ã–Ω–µ—Å–µ–Ω–æ –∏–∑ app.py (14%)

---

## üéØ –°–ª–µ–¥—É—é—â–∞—è —Ñ–∞–∑–∞: Knowledge Router

### –ó–∞–¥–∞—á–∞: –°–æ–∑–¥–∞—Ç—å `app/routers/knowledge.py` (~2000 LOC)

**–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:

#### 1. –û—Å–Ω–æ–≤–Ω—ã–µ knowledge endpoints (~800 LOC)
- `GET /api/v1/admin/knowledge` - —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `POST /api/v1/admin/knowledge` - —Å–æ–∑–¥–∞—Ç—å/–∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
- `PUT /api/v1/admin/knowledge/{id}` - –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
- `DELETE /api/v1/admin/knowledge/{id}` - —É–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
- `GET /api/v1/admin/knowledge/documents/{file_id}` - —Å–∫–∞—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `_get_mongo_client`, `_resolve_admin_project`, `_normalize_project` –∏–∑ app.py
- `_project_response` –∏–∑ app.py
- Pydantic –º–æ–¥–µ–ª–∏: `KnowledgeCreate`, `KnowledgeUpdate` –∏–∑ app.py

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**:
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ app.py —á–µ—Ä–µ–∑ lazy imports
- –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å Pydantic –º–æ–¥–µ–ª–∏ –≤ –Ω–∞—á–∞–ª–æ —Ä–æ—É—Ç–µ—Ä–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@router` –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –≤–º–µ—Å—Ç–æ `@app`

#### 2. Q&A endpoints (~800 LOC)
- `GET /api/v1/admin/knowledge/qa` - —Å–ø–∏—Å–æ–∫ Q&A –ø–∞—Ä
- `POST /api/v1/admin/knowledge/qa` - —Å–æ–∑–¥–∞—Ç—å Q&A
- `PUT /api/v1/admin/knowledge/qa/{id}` - –æ–±–Ω–æ–≤–∏—Ç—å Q&A
- `DELETE /api/v1/admin/knowledge/qa/{id}` - —É–¥–∞–ª–∏—Ç—å Q&A
- `POST /api/v1/admin/knowledge/qa/upload` - –∏–º–ø–æ—Ä—Ç –∏–∑ CSV/Excel
- `POST /api/v1/admin/knowledge/qa/reorder` - –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫
- `POST /api/v1/admin/knowledge/qa/unanswered/clear` - –æ—á–∏—Å—Ç–∏—Ç—å –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- –¢–µ –∂–µ, —á—Ç–æ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö endpoints
- Pydantic –º–æ–¥–µ–ª–∏: `KnowledgeQAPayload`, `KnowledgeQAReorderPayload` –∏ —Ç.–¥.
- Helper —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è CSV/Excel –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ app.py

#### 3. Knowledge service endpoints (~400 LOC)
- `GET /api/v1/admin/knowledge/service` - —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
- `POST /api/v1/admin/knowledge/service` - –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- `POST /api/v1/admin/knowledge/service/run` - –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
- `POST /api/intelligent-processing/prompt` - –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `_require_super_admin` –∏–∑ app/services/auth.py
- `_knowledge_service_status_impl`, `_knowledge_service_update_impl` –∏–∑ app.py
- Pydantic –º–æ–¥–µ–ª—å: `KnowledgeServiceConfig` –∏–∑ app.py

---

## üìã –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
1. –ù–∞–π—Ç–∏ –≤—Å–µ knowledge-related endpoints –≤ app.py
2. –ù–∞–π—Ç–∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Pydantic –º–æ–¥–µ–ª–∏
3. –ù–∞–π—Ç–∏ –≤—Å–µ helper —Ñ—É–Ω–∫—Ü–∏–∏

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞
1. –°–æ–∑–¥–∞—Ç—å `app/routers/knowledge.py`
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å Pydantic –º–æ–¥–µ–ª–∏
4. –°–æ–∑–¥–∞—Ç—å router: `router = APIRouter(prefix="/api/v1/admin", tags=["knowledge"])`

### –®–∞–≥ 3: –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ endpoints (–ø–æ –≥—Ä—É–ø–ø–∞–º)
1. **–ì—Ä—É–ø–ø–∞ 1**: –û—Å–Ω–æ–≤–Ω—ã–µ knowledge endpoints
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å endpoint —Ñ—É–Ω–∫—Ü–∏–∏
   - –ó–∞–º–µ–Ω–∏—Ç—å `@app` –Ω–∞ `@router`
   - –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ lazy imports
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞

2. **–ì—Ä—É–ø–ø–∞ 2**: Q&A endpoints
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≥—Ä—É–ø–ø–µ 1

3. **–ì—Ä—É–ø–ø–∞ 3**: Knowledge service endpoints
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≥—Ä—É–ø–ø–µ 1

### –®–∞–≥ 4: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞
1. –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç –≤ app.py: `from app.routers import knowledge as knowledge_router`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å: `app.include_router(knowledge_router.router)`
3. –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ endpoints –≤ app.py

### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä: `read_lints`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã
3. –û–±–Ω–æ–≤–∏—Ç—å TODO

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

1. **–ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä endpoints** (~2000 LOC)
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –†–∞–∑–±–∏—Ç—å –Ω–∞ 3 –≥—Ä—É–ø–ø—ã, –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ –∑–∞ —Ä–∞–∑

2. **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å lazy imports, –≤—ã–Ω–µ—Å—Ç–∏ –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `app/services/`

3. **–ú–Ω–æ–≥–æ helper —Ñ—É–Ω–∫—Ü–∏–π –≤ app.py**
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ lazy imports, –æ—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ app.py

---

## üéØ –¶–µ–ª–µ–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- `app/routers/knowledge.py`: ~2000 LOC
- `app.py`: —É–º–µ–Ω—å—à–∏—Ç—Å—è –Ω–∞ ~2000 LOC
- –í—Å–µ knowledge endpoints –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `/api/v1/admin/knowledge/*`
- Backward compatibility —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Ä–æ—É—Ç–µ—Ä–∞

---

*–ü–ª–∞–Ω –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ—à–∞–≥–æ–≤–æ, –Ω–∞—á–∏–Ω–∞—è —Å–æ —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥—ã*

