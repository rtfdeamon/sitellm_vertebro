<!--
  Minimal admin panel to trigger the crawler and watch counters.
  This page posts to the FastAPI endpoint /api/v1/crawler/run and polls
  /api/v1/crawler/status every 3 seconds to update the UI.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crawler Admin</title>
</head>
<body>
  <form id="crawler-form">
    <label>URL: <input type="url" id="url" required></label><br>
    <label>Depth: <input type="number" id="depth" min="1" value="1"></label><br>
    <label>Pages: <input type="number" id="pages" min="1" value="10"></label><br>
    <button type="submit">Запустить</button>
  </form>

  <h2>Status</h2>
  <ul>
    <li>Queued: <span id="queued">0</span></li>
    <li>In progress: <span id="in_progress">0</span></li>
    <li>Done: <span id="done">0</span></li>
    <li>Failed: <span id="failed">0</span></li>
  </ul>

  <script>
    const form = document.getElementById('crawler-form');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = {
        url: document.getElementById('url').value,
        depth: Number(document.getElementById('depth').value),
        pages: Number(document.getElementById('pages').value),
      };
      await fetch('/api/v1/crawler/run', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload),
      });
    });

    async function pollStatus() {
      try {
        const resp = await fetch('/api/v1/crawler/status');
        if (resp.ok) {
          const data = await resp.json();
          document.getElementById('queued').textContent = data.queued;
          document.getElementById('in_progress').textContent = data.in_progress;
          document.getElementById('done').textContent = data.done;
          document.getElementById('failed').textContent = data.failed;
        }
      } catch (err) {
        console.error(err);
      }
    }
    setInterval(pollStatus, 3000);
    pollStatus();
  </script>
</body>
</html>
