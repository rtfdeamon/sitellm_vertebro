<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Crawler Progress</title>
  <style>
    body { font-family: sans-serif; }
    pre { background: #f0f0f0; padding: 1rem; }
  </style>
</head>
<body>
  <h1>Crawler Progress</h1>
  <pre id="output"></pre>
  <script>
    const output = document.getElementById('output');

    function render(data) {
      output.textContent = JSON.stringify(data, null, 2);
    }

    async function poll() {
      try {
        const resp = await fetch('/api/v1/crawler/status');
        if (resp.ok) {
          const json = await resp.json();
          render(json);
        }
      } catch (err) {
        console.error('Polling error', err);
      }
    }

    if (window.EventSource) {
      const es = new EventSource('/api/v1/crawler/stream');
      es.onmessage = (e) => {
        try {
          render(JSON.parse(e.data));
        } catch (err) {
          console.error('Invalid SSE data', err);
        }
      };
      es.onerror = () => {
        es.close();
        setInterval(poll, 2000);
      };
    } else {
      setInterval(poll, 2000);
    }
  </script>
</body>
</html>
