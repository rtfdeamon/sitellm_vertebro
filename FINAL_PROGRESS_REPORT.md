# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ - SiteLLM Vertebro

**–î–∞—Ç–∞**: 2025-11-16  
**–°—Ç–∞—Ç—É—Å**: –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (6 –∑–∞–¥–∞—á)

### 1. Testing & Quality ‚úÖ
- ‚úÖ **test-coverage-1**: Coverage threshold —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 90% (pytest.ini, CI)
- ‚úÖ **test-perf-1**: –°–æ–∑–¥–∞–Ω—ã performance —Ç–µ—Å—Ç—ã (tests/performance/test_api_latency.py)
- ‚úÖ **ci-improve-1**: –£–ª—É—á—à–µ–Ω CI/CD pipeline (—É–±—Ä–∞–Ω–æ continue-on-error, –¥–æ–±–∞–≤–ª–µ–Ω—ã performance —Ç–µ—Å—Ç—ã)
- ‚úÖ **summary-tests-1**: –†–∞—Å—à–∏—Ä–µ–Ω—ã summary —Ç–µ—Å—Ç—ã –¥–æ 95%+ –ø–æ–∫—Ä—ã—Ç–∏—è (2 ‚Üí 28+ —Ç–µ—Å—Ç–æ–≤)

### 2. Refactor & Performance ‚úÖ
- ‚úÖ **crawler-robust-1**: –î–æ–±–∞–≤–ª–µ–Ω retry logic –∏ —É–ª—É—á—à–µ–Ω–∏—è –≤ crawler
  - REQUEST_TIMEOUT: 10s ‚Üí 30s
  - MAX_REDIRECTS = 5
  - MAX_RETRIES = 3 —Å exponential backoff
  - Connection pooling –¥–ª—è httpx.AsyncClient
  - Structured error logging

### 3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ app.py ‚úÖ (–Ω–∞—á–∞—Ç)
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (`REFACTORING_PLAN.md`)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (`app/routers/`, `app/services/`, `app/models/`)
- ‚úÖ –°–æ–∑–¥–∞–Ω `app/services/auth.py` —Å AdminIdentity –∏ helper —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω `app/routers/backup.py` —Å backup endpoints (~200 LOC)
- ‚úÖ Backup endpoints –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –∏–∑ app.py –≤ router
- ‚úÖ Backup router –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ app.py

---

## ‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ app.py (–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è)
**–û—Å—Ç–∞–ª–æ—Å—å**:
- [ ] –°–æ–∑–¥–∞—Ç—å `app/routers/stats.py` (~200 LOC)
- [ ] –°–æ–∑–¥–∞—Ç—å `app/routers/admin.py` (~500 LOC)  
- [ ] –°–æ–∑–¥–∞—Ç—å `app/routers/knowledge.py` (~2000 LOC) - –±–æ–ª—å—à–æ–π –±–ª–æ–∫
- [ ] –°–æ–∑–¥–∞—Ç—å `app/routers/projects.py` (~1500 LOC) - –±–æ–ª—å—à–æ–π –±–ª–æ–∫
- [ ] –°–æ–∑–¥–∞—Ç—å `app/main.py` —Å factory (<500 LOC)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `app/__init__.py` –¥–ª—è backward compatibility
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ imports
- [ ] –î–æ–±–∞–≤–∏—Ç—å smoke tests

### Knowledge Summary —É–ª—É—á—à–µ–Ω–∏—è
- [ ] Batch calls –∫ LLM
- [ ] Redis caching –¥–ª—è summaries
- [ ] Metrics (success/failure, latency, token usage)

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–í—Å–µ–≥–æ –∑–∞–¥–∞—á**: 13  
**–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: 6 (46%)  
**–í –ø—Ä–æ—Ü–µ—Å—Å–µ**: 7 (54%)

**–ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ app.py**:
- ‚úÖ Backup router —Å–æ–∑–¥–∞–Ω (200 LOC –≤—ã–Ω–µ—Å–µ–Ω–æ)
- ‚è≥ –û—Å—Ç–∞–ª–æ—Å—å: ~6500 LOC –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- **–¶–µ–ª—å**: –†–∞–∑–±–∏—Ç—å 7101 —Å—Ç—Ä–æ–∫—É –Ω–∞ –º–æ–¥—É–ª–∏ <500 LOC –∫–∞–∂–¥—ã–π

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ app.py** - —Å–æ–∑–¥–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
2. **–°–æ–∑–¥–∞—Ç—å app/main.py** - factory –∏ middleware setup
3. **–û–±–Ω–æ–≤–∏—Ç—å app/__init__.py** - backward compatibility
4. **–î–æ–±–∞–≤–∏—Ç—å smoke tests** - –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞
5. **–£–ª—É—á—à–∏—Ç—å knowledge/summary.py** - caching –∏ metrics

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

**–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ app.py** - —ç—Ç–æ –±–æ–ª—å—à–∞—è –∑–∞–¥–∞—á–∞ (7101 —Å—Ç—Ä–æ–∫–∞ ‚Üí –º–æ–¥—É–ª–∏ <500 LOC).  
–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—ç—Ç–∞–ø–Ω–æ –ø–æ –ø–ª–∞–Ω—É. –ü–µ—Ä–≤—ã–π —Ä–æ—É—Ç–µ—Ä (backup) —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** —Ä–µ—à–µ–Ω—ã —á–µ—Ä–µ–∑:
- –í—ã–Ω–æ—Å AdminIdentity –≤ `app/services/auth.py`
- –ò–º–ø–æ—Ä—Ç –ø–æ—Å–ª–µ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π –≤ app.py
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ lazy imports –≤ —Ä–æ—É—Ç–µ—Ä–∞—Ö –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ

---

*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-11-16*

